# 115网盘STRM助手

## 功能介绍

115网盘STRM助手是一个为MoviePilot设计的插件，可以自动从115网盘生成STRM流媒体文件，轻松将115网盘中的影视资源添加到您的媒体库中。

主要功能：
- 监控MoviePilot整理入库事件，自动生成对应的STRM文件
- 全量同步扫描网盘目录，批量生成STRM文件
- 监控115生活事件（上传、移动、删除等），自动同步STRM文件
- 支持115分享链接/分享码生成STRM文件
- 支持刷新媒体服务器库
- 支持自动下载媒体数据文件（字幕等）

## 安装方法

1. 在MoviePilot插件市场中搜索"115网盘STRM助手"并安装
2. 或者手动将此插件文件夹复制到MoviePilot的plugins目录下

## 配置说明

### 基础设置
- **启用插件**：开启或关闭插件功能
- **115 Cookie**：115网盘登录Cookie，可通过扫码登录获取
- **MoviePilot内网访问地址**：用于生成STRM文件中的内部访问地址
- **媒体文件扩展名**：支持的视频文件扩展名和可下载的数据文件扩展名

### 监控MP整理
配置MoviePilot整理入库事件监控，自动生成STRM文件：
- 配置本地STRM目录和网盘媒体库目录的映射关系
- 支持STRM自动刮削和媒体服务器刷新

### 全量同步
全量扫描指定网盘目录，批量生成STRM文件：
- 支持定时自动同步
- 可设置本地STRM目录和网盘媒体库目录的映射关系

### 监控115生活事件
监控115网盘文件变动，自动同步STRM文件：
- 支持自动创建、删除STRM文件
- 支持自动刮削和媒体服务器刷新

### 分享生成STRM
通过115分享链接或分享码生成STRM文件：
- 支持设置分享文件在网盘中的路径
- 支持设置本地生成STRM的路径

### 定期清理
定期清理115网盘中的垃圾文件和临时文件：
- 支持设置清理间隔和文件保留天数
- 可设置最小文件大小和文件扩展名过滤条件

## 路径映射格式说明

所有路径映射采用`本地路径#网盘路径`的格式，多个映射关系使用换行符分隔。例如：

```
/mnt/media/电影#/我的电影
/mnt/media/电视剧#/我的剧集
```

上面的例子表示：
- 网盘中的`/我的电影`目录对应生成STRM文件到本地的`/mnt/media/电影`目录
- 网盘中的`/我的剧集`目录对应生成STRM文件到本地的`/mnt/media/电视剧`目录

## 使用指南

### 首次使用
1. 安装插件后，进入插件配置页面
2. 点击"扫码登录"按钮，使用115手机APP扫码登录
3. 设置MoviePilot内网访问地址和媒体文件扩展名
4. 配置路径映射关系
5. 启用所需的功能，如监控MP整理、全量同步等
6. 保存配置

### 常见操作
- **全量同步**：在仪表盘页面点击"全量同步"按钮，系统将扫描配置的网盘目录，并在对应的本地目录生成STRM文件
- **分享同步**：在仪表盘页面点击"分享同步"按钮，系统将根据配置的分享链接或分享码，生成分享内容的STRM文件到本地目录
- **查看状态**：在仪表盘页面可查看插件状态、功能开启状态和路径配置情况

## 错误排查

### 二维码获取失败
- **问题**: 获取二维码失败: Error: 获取二维码失败: Expecting value: line 1 column 1 (char 0)
- **解决方案**: 
  1. 确保MoviePilot正常运行，可在插件市场中查看插件是否正确加载
  2. 刷新页面并重试获取二维码
  3. 检查MoviePilot日志中是否有相关错误信息

### API接口404错误
- **问题**: GET http://localhost:5173/api/v1/plugin/P115StrmHelper/xxx 404 (Not Found)
- **解决方案**:
  1. 确保插件已启用，在配置页面中开启插件
  2. 插件未启用时，API不会注册，会导致404错误
  3. 保存插件配置后刷新页面

### 路径选择器不显示目录
- **问题**: 本地或网盘路径选择器不显示任何目录
- **解决方案**:
  1. 对于网盘路径选择器，确保已设置有效的115 Cookie
  2. 对于本地路径选择器，确保MoviePilot有权限访问该目录
  3. 尝试手动输入路径并按回车键加载目录

### 配置保存后不生效
- **问题**: 修改配置后保存，但设置似乎没有生效
- **解决方案**:
  1. 确保点击"保存配置"按钮后看到保存成功的提示
  2. 切换到仪表盘页面查看状态是否更新
  3. 如果状态未更新，点击"刷新状态"按钮

### 生成的STRM文件无法播放
- **问题**: STRM文件生成成功，但播放时报错
- **解决方案**:
  1. 检查MoviePilot内网访问地址设置是否正确
  2. 确保媒体服务器能够访问MoviePilot内网地址
  3. 检查115网盘Cookie是否有效，可通过刷新二维码重新登录

## 联系与支持

如遇到问题或有功能建议，请通过GitHub提出Issue或加入MoviePilot社区交流：

- GitHub项目地址: [https://github.com/jxxghp/MoviePilot](https://github.com/jxxghp/MoviePilot)
- MoviePilot社区: [https://github.com/jxxghp/MoviePilot/discussions](https://github.com/jxxghp/MoviePilot/discussions)

## 版权与许可

本插件基于MIT许可证开源，详情请参阅LICENSE文件。 